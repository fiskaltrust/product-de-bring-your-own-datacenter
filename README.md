# fiskaltrust.Middleware - Bring your own Data Center

### Problem description:
You have a distributed architecture of your point of sale system and therefore you are not able to connect a tse device directly to your pos-terminal. An on site (branchoffice) installation of the fiskaltrust.Middleware is not possible or would not be efficient.

### Solution proposal:
By providing a standardized hardware platform by the customer, fiskaltrust.Middleware using a cloud-tse can be brought to the datatcenter directly where the receipt generation process of a distributed point of sale system occurs. This can be devlivered by a predefined Kubernetes Namespace which can be deployed by a Helm-Chart.
fiskaltrust provides a "Backend POD" Docker image and Helm-Charts to deploy your own environment.

## Architecture Overview
![Architecture Overview](images/fiskaltrust-ByoDC-Architecture-Overview.png)

## [helm chart](https://github.com/fiskaltrust/helm-charts/tree/master/bring-your-own-datacenter)

## Requirements

* Kubernetes cluster > v1.16
* helm > v3.0
* Network Connection Matrix and used IP Scopes can be found at [Network Requirements](NetworkRequirements.md)

## Quickstart
A brief step-by-step guide to get ByoDC up and running on your Docker Desktop can be found [here](QuickStart.md) 

## Installation

### Create Namespace

Connect to your Kubernetes cluster and create the `bring-your-own-datacenter` namespace.

```sh
kubectl create namespace bring-your-own-datacenter
```

### Add helm repository

First add the fiskaltrust helm repository.

```sh
helm repo add fiskaltrust https://charts.fiskaltrust.cloud/
```
Update helm repository
```sh
helm repo update
```


> ***Note:** You can also skip this step, clone this repo and use the path to the `Chart.yaml` file as repo in the following commands.*

### Configure values

You can view all configurable values by running the following command.

```sh
helm show values fiskaltrust/bring-your-own-datacenter
```

This will output a `values.yaml` file containing all of the default values. You can create a file `config.yaml` and override the values you need.

### Install chart

You can install the chart like this:

```sh
helm install bring-your-own-datcenter fiskaltrust/bring-your-own-datacenter --namespace bring-your-own-datacenter -f config.yaml
```

Leave out `-f config.yaml` to install it with default values.

> ***Note:** If you use a local repo you will have to run `helm dependency update` before installing.*

## Updating

Please see the [Migration Guide](https://github.com/fiskaltrust/helm-charts/blob/master/bring-your-own-datacenter/MIGRATION.md) for update instructions of specific versions.

If the version is not listed in the Migration Guide you can update the chart like this:

```sh
helm repo update
helm upgrade --install bring-your-own-datcenter fiskaltrust/bring-your-own-datacenter --namespace bring-your-own-datacenter -f config.yaml
```

> ***Note:** The backend Pods will automatically update to the newest minor Middleware version. If this behaviour is not wanted you can set the [`byodc.image.tag` Parameter](./ParameterReference.md#section-byodc) in your `config.yaml` to a specific version (e.g. `1.3.29-buster`).

## Uninstallation

```sh
helm uninstall bring-your-own-datacenter --namespace bring-your-own-datacenter
kubectl delete namespace bring-your-own-datacenter
```

## Supported Configurations

## Queues

* MySQL

## SCUs

* FiskalyCertified
* [SwissbitCloud](#Host-FiscalCloudConnector-instances-in-Bring-your-own-Data-Center)

## Parameter Reference
All Parameters and values you can use in "values.yaml" can be found [here](ParameterReference.md)

## HTTPS Reference
How to deal with SSL Certificates on the Ambassador endpoint can be found [here](HTTPSReference.md)

## API Reference
ByoDC uses [swagger](https://swagger.io/) to provide [OpenAPI](https://github.com/OAI/OpenAPI-Specification/blob/master/versions/3.0.2.md) service definitions of the exposed API.

The API Explorer can be found at the `/swagger` endpoint and the OpenAPI definition at `/swagger/v1/swagger.json`.

## Operations Reference
Collection of OPS related topics and QnAs [here](OperationsReference.md)

## Host FiscalCloudConnector instances in Bring your own Data Center
Bring your own Data Center can be configured to host FiscalCloudConnector instances in kubernetes. More details can be found [here](how-to-fiscal-cloud-connector.md).

## Minimal installations
In scenarios where only very few CashBoxes are operated and high availability is not a crucial factor, it's also possible to host a standalone instance of the BYODC container. More details can be found [here](howto-single-instance.md).
